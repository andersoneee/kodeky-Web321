<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuantumStock ‚Ä¢ UPA Guarulhos</title>
    <style>
        :root {
            --primary: #1e40af;  /* AZUL SA√öDE */
            --primary-dark: #1e3a8a;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #dc2626;
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f8fafc;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(30, 64, 175, 0.3);
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .subtitle {
            font-size: 14px;
            opacity: 0.9;
        }

        .clock {
            margin-top: 10px;
            font-size: 13px;
            background: rgba(255,255,255,0.1);
            padding: 8px 12px;
            border-radius: 10px;
            display: inline-block;
        }

        /* CARDS DE ESTOQUE */
        .estoque-grid {
            display: grid;
            gap: 12px;
            margin-bottom: 20px;
        }

        .item-estoque {
            background: var(--card);
            padding: 16px;
            border-radius: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid var(--success);
            transition: all 0.3s ease;
        }

        .item-estoque.critico {
            border-left-color: var(--danger);
            animation: pulse 2s infinite;
            background: linear-gradient(90deg, rgba(220, 38, 38, 0.1), var(--card));
        }

        .item-estoque.alerta {
            border-left-color: var(--warning);
            background: linear-gradient(90deg, rgba(245, 158, 11, 0.1), var(--card));
        }

        .info-produto h3 {
            font-size: 16px;
            margin-bottom: 4px;
        }

        .categoria {
            font-size: 12px;
            opacity: 0.7;
        }

        .quantidade {
            text-align: right;
        }

        .valor {
            font-size: 20px;
            font-weight: bold;
        }

        .unidade {
            font-size: 12px;
            opacity: 0.7;
        }

        /* CONTROLES */
        .controles {
            background: var(--card);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
        }

        .input-group {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            margin-bottom: 15px;
        }

        select, input {
            padding: 12px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.05);
            color: var(--text);
            font-size: 16px;
        }

        .botoes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        button {
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-entrada {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
        }

        .btn-saida {
            background: linear-gradient(135deg, var(--danger), #b91c1c);
            color: white;
        }

        .btn-relatorio {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            width: 100%;
            margin-bottom: 10px;
        }

        .btn-login {
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
            color: white;
            width: 100%;
            margin-bottom: 10px;
        }

        .btn-reset {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            width: 100%;
            margin-bottom: 10px;
        }

        /* ALERTAS */
        .alertas {
            margin-bottom: 20px;
        }

        .alerta {
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .alerta.critico {
            background: linear-gradient(90deg, rgba(220, 38, 38, 0.2), rgba(220, 38, 38, 0.1));
            border: 1px solid rgba(220, 38, 38, 0.3);
            animation: pulse-alerta 2s infinite;
        }

        .alerta.atencao {
            background: linear-gradient(90deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.1));
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .ponto-alerta {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .ponto-alerta.critico {
            background: var(--danger);
            box-shadow: 0 0 10px var(--danger);
            animation: pulse-ponto 2s infinite;
        }

        .ponto-alerta.atencao {
            background: var(--warning);
            box-shadow: 0 0 10px var(--warning);
        }

        /* MODAL LOGIN */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--card);
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .modal h2 {
            margin-bottom: 20px;
            color: var(--text);
        }

        .modal-input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.05);
            color: var(--text);
            font-size: 16px;
        }

        .modal-botoes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .btn-confirmar {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
        }

        .btn-cancelar {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
        }

        /* NOTIFICA√á√ÉO */
        .notificacao {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1001;
            display: none;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes pulse-alerta {
            0%, 100% { 
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.4);
            }
            50% { 
                box-shadow: 0 0 0 10px rgba(220, 38, 38, 0);
            }
        }

        @keyframes pulse-ponto {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 10px var(--danger);
            }
            50% { 
                transform: scale(1.2);
                box-shadow: 0 0 20px var(--danger);
            }
        }

        /* RESPONSIVO */
        @media (max-width: 380px) {
            .input-group {
                grid-template-columns: 1fr;
            }
            
            .botoes {
                grid-template-columns: 1fr;
            }
            
            .header {
                padding: 15px;
            }
            
            .modal-botoes {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- NOTIFICA√á√ÉO -->
        <div class="notificacao" id="notificacao"></div>

        <!-- HEADER PERSONALIZADO -->
        <div class="header">
            <div class="logo">üè• UPA Guarulhos</div>
            <div class="subtitle">Controle Inteligente de Medicamentos</div>
            <div class="clock" id="clock">--/--/---- --:--:--</div>
        </div>

        <!-- BOT√ïES SUPERIORES -->
        <button class="btn-relatorio" onclick="gerarRelatorio()">
            üìä GERAR RELAT√ìRIO COMPLETO
        </button>
        
        <button class="btn-login" onclick="abrirLogin()" id="btnLogin">
            üîë ACESSO ADMINISTRADOR
        </button>

        <button class="btn-reset" onclick="resetarEstoque()" id="btnReset">
            üîÑ RESTAURAR ESTOQUE PADR√ÉO
        </button>

        <!-- ESTOQUE -->
        <div class="estoque-grid" id="estoqueList">
            <!-- Itens carregados via JavaScript -->
        </div>

        <!-- CONTROLES (S√ì VIS√çVEL PARA ADMIN) -->
        <div class="controles" id="controles" style="display: none;">
            <div class="input-group">
                <select id="selectProduto">
                    <option value="">Selecione o medicamento</option>
                </select>
                <input type="number" id="inputQuantidade" placeholder="Qtd" min="1" value="1">
            </div>
            <div class="botoes">
                <button class="btn-entrada" onclick="entradaEstoque()">‚ûï ENTRADA</button>
                <button class="btn-saida" onclick="saidaEstoque()">‚ûñ SA√çDA</button>
            </div>
        </div>

        <!-- ALERTAS -->
        <div class="alertas" id="alertasContainer">
            <!-- Alertas carregados via JavaScript -->
        </div>
    </div>

    <!-- MODAL LOGIN -->
    <div class="modal" id="modalLogin">
        <div class="modal-content">
            <h2>üîí ACESSO ADMINISTRADOR</h2>
            <input type="password" id="senhaAdmin" class="modal-input" placeholder="Digite a senha" onkeypress="verificarEnter(event)">
            <div class="modal-botoes">
                <button class="btn-confirmar" onclick="verificarSenha()">‚úÖ CONFIRMAR</button>
                <button class="btn-cancelar" onclick="fecharLogin()">‚ùå CANCELAR</button>
            </div>
        </div>
    </div>

    <script>
        // DADOS INICIAIS - MEDICAMENTOS HOSPITALARES
        const medicamentosIniciais = [
            { nome: "Dipirona 1g", quantidade: 15, categoria: "Analg√©sico", minimo: 20 },
            { nome: "Paracetamol 750mg", quantidade: 8, categoria: "Analg√©sico", minimo: 15 },
            { nome: "Soro Fisiol√≥gico 500ml", quantidade: 3, categoria: "Soros", minimo: 10 },
            { nome: "Luvas Descart√°veis", quantidade: 45, categoria: "EPI", minimo: 50 },
            { nome: "M√°scara Cir√∫rgica", quantidade: 120, categoria: "EPI", minimo: 100 },
            { nome: "Insulina Regular", quantidade: 5, categoria: "Hormonal", minimo: 8 }
        ];

        // SENHA DO ADMINISTRADOR
        const SENHA_ADMIN = "upa123";
        let adminLogado = false;
        let medicamentos = [];

        // NOTIFICA√á√ÉO
        function mostrarNotificacao(mensagem, tipo = 'success') {
            const notificacao = document.getElementById('notificacao');
            notificacao.textContent = mensagem;
            notificacao.style.background = tipo === 'success' ? '#10b981' : '#dc2626';
            notificacao.style.display = 'block';
            
            setTimeout(() => {
                notificacao.style.display = 'none';
            }, 3000);
        }

        // FUN√á√ïES DE ARMAZENAMENTO - CHAVE √öNICA
        function salvarEstoque() {
            try {
                const dados = {
                    medicamentos: medicamentos,
                    ultimaAtualizacao: new Date().toISOString()
                };
                localStorage.setItem('quantumStock_upa_guarulhos_v2', JSON.stringify(dados));
                console.log('‚úÖ Estoque salvo:', dados);
            } catch (e) {
                console.error('‚ùå Erro ao salvar:', e);
            }
        }

        function carregarEstoqueSalvo() {
            try {
                const dadosSalvos = localStorage.getItem('quantumStock_upa_guarulhos_v2');
                if (dadosSalvos) {
                    const dados = JSON.parse(dadosSalvos);
                    console.log('üì¶ Estoque carregado:', dados);
                    return dados.medicamentos;
                }
            } catch (e) {
                console.error('‚ùå Erro ao carregar:', e);
            }
            return null;
        }

        function inicializarEstoque() {
            const estoqueSalvo = carregarEstoqueSalvo();
            if (estoqueSalvo && estoqueSalvo.length > 0) {
                medicamentos = estoqueSalvo;
                mostrarNotificacao('üì¶ Estoque carregado com sucesso!');
            } else {
                // Cria uma c√≥pia profunda dos dados iniciais
                medicamentos = JSON.parse(JSON.stringify(medicamentosIniciais));
                salvarEstoque();
                mostrarNotificacao('üÜï Estoque inicial criado!');
            }
        }

        // ATUALIZAR REL√ìGIO
        function atualizarRelogio() {
            const agora = new Date();
            document.getElementById('clock').textContent = 
                agora.toLocaleDateString('pt-BR') + ' ' + 
                agora.toLocaleTimeString('pt-BR');
            setTimeout(atualizarRelogio, 1000);
        }

        // CARREGAR ESTOQUE NA TELA
        function carregarEstoque() {
            const container = document.getElementById('estoqueList');
            const select = document.getElementById('selectProduto');
            
            container.innerHTML = '';
            select.innerHTML = '<option value="">Selecione o medicamento</option>';
            
            medicamentos.forEach((med, index) => {
                // Item no estoque
                const item = document.createElement('div');
                item.className = `item-estoque ${med.quantidade <= med.minimo/2 ? 'critico' : 
                                 med.quantidade <= med.minimo ? 'alerta' : ''}`;
                
                item.innerHTML = `
                    <div class="info-produto">
                        <h3>${med.nome}</h3>
                        <div class="categoria">${med.categoria}</div>
                    </div>
                    <div class="quantidade">
                        <div class="valor">${med.quantidade}</div>
                        <div class="unidade">unidades</div>
                    </div>
                `;
                container.appendChild(item);
                
                // Option no select (s√≥ se for admin)
                if (adminLogado) {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = med.nome;
                    select.appendChild(option);
                }
            });
            
            carregarAlertas();
        }

        // CARREGAR ALERTAS
        function carregarAlertas() {
            const container = document.getElementById('alertasContainer');
            container.innerHTML = '';
            
            const alertas = medicamentos.filter(med => med.quantidade <= med.minimo);
            
            if (alertas.length === 0) {
                container.innerHTML = `
                    <div class="alerta" style="background: rgba(16, 185, 129, 0.1); border-color: rgba(16, 185, 129, 0.3);">
                        <div class="ponto-alerta" style="background: #10b981;"></div>
                        <div>‚úÖ Todos os medicamentos em ordem!</div>
                    </div>
                `;
                return;
            }
            
            alertas.forEach(med => {
                const alerta = document.createElement('div');
                alerta.className = `alerta ${med.quantidade <= med.minimo/2 ? 'critico' : 'atencao'}`;
                alerta.innerHTML = `
                    <div class="ponto-alerta ${med.quantidade <= med.minimo/2 ? 'critico' : 'atencao'}"></div>
                    <div>
                        ${med.quantidade <= med.minimo/2 ? 'üö® CR√çTICO' : '‚ö†Ô∏è ATEN√á√ÉO'}: 
                        ${med.nome} - ${med.quantidade} unidades
                    </div>
                `;
                container.appendChild(alerta);
            });
        }

        // FUN√á√ïES DE LOGIN
        function abrirLogin() {
            document.getElementById('modalLogin').style.display = 'flex';
            document.getElementById('senhaAdmin').focus();
        }

        function fecharLogin() {
            document.getElementById('modalLogin').style.display = 'none';
            document.getElementById('senhaAdmin').value = '';
        }

        function verificarEnter(event) {
            if (event.key === 'Enter') {
                verificarSenha();
            }
        }

        function verificarSenha() {
            const senha = document.getElementById('senhaAdmin').value;
            
            if (senha === SENHA_ADMIN) {
                adminLogado = true;
                document.getElementById('controles').style.display = 'block';
                document.getElementById('btnLogin').textContent = 'üîì ADMINISTRADOR LOGADO';
                document.getElementById('btnLogin').style.background = 'linear-gradient(135deg, #10b981, #059669)';
                fecharLogin();
                carregarEstoque(); // Recarrega para mostrar os selects
                mostrarNotificacao('‚úÖ Acesso administrativo concedido!');
            } else {
                mostrarNotificacao('‚ùå Senha incorreta! Acesso negado.', 'error');
                document.getElementById('senhaAdmin').value = '';
                document.getElementById('senhaAdmin').focus();
            }
        }

        // ENTRADA NO ESTOQUE
        function entradaEstoque() {
            if (!adminLogado) {
                mostrarNotificacao('üîí Acesso restrito! Fa√ßa login como administrador.', 'error');
                abrirLogin();
                return;
            }
            
            const select = document.getElementById('selectProduto');
            const input = document.getElementById('inputQuantidade');
            const index = parseInt(select.value);
            const quantidade = parseInt(input.value);
            
            if (isNaN(index) || isNaN(quantidade) || quantidade <= 0) {
                mostrarNotificacao('‚ùå Selecione um medicamento e informe uma quantidade v√°lida!', 'error');
                return;
            }
            
            const quantidadeAntiga = medicamentos[index].quantidade;
            medicamentos[index].quantidade += quantidade;
            input.value = 1;
            
            salvarEstoque(); // SALVA AS ALTERA√á√ïES
            carregarEstoque();
            
            mostrarNotificacao(`‚úÖ ${quantidade} ${medicamentos[index].nome} adicionados! (${quantidadeAntiga} ‚Üí ${medicamentos[index].quantidade})`);
        }

        // SA√çDA DO ESTOQUE
        function saidaEstoque() {
            if (!adminLogado) {
                mostrarNotificacao('üîí Acesso restrito! Fa√ßa login como administrador.', 'error');
                abrirLogin();
                return;
            }
            
            const select = document.getElementById('selectProduto');
            const input = document.getElementById('inputQuantidade');
            const index = parseInt(select.value);
            const quantidade = parseInt(input.value);
            
            if (isNaN(index) || isNaN(quantidade) || quantidade <= 0) {
                mostrarNotificacao('‚ùå Selecione um medicamento e informe uma quantidade v√°lida!', 'error');
                return;
            }
            
            if (medicamentos[index].quantidade < quantidade) {
                mostrarNotificacao(`‚ùå Estoque insuficiente! Dispon√≠vel: ${medicamentos[index].quantidade}`, 'error');
                return;
            }
            
            const quantidadeAntiga = medicamentos[index].quantidade;
            medicamentos[index].quantidade -= quantidade;
            input.value = 1;
            
            salvarEstoque(); // SALVA AS ALTERA√á√ïES
            carregarEstoque();
            
            mostrarNotificacao(`‚úÖ ${quantidade} ${medicamentos[index].nome} retirados! (${quantidadeAntiga} ‚Üí ${medicamentos[index].quantidade})`);
        }

        // RESETAR ESTOQUE PARA VALORES PADR√ÉO
        function resetarEstoque() {
            if (!adminLogado) {
                mostrarNotificacao('üîí Acesso restrito! Fa√ßa login como administrador.', 'error');
                abrirLogin();
                return;
            }
            
            if (confirm('‚ö†Ô∏è Tem certeza que deseja restaurar o estoque para os valores padr√£o? Isso ir√° sobrescrever todos os dados atuais.')) {
                medicamentos = JSON.parse(JSON.stringify(medicamentosIniciais));
                salvarEstoque();
                carregarEstoque();
                mostrarNotificacao('‚úÖ Estoque restaurado para os valores padr√£o!');
            }
        }

        // GERAR RELAT√ìRIO
        function gerarRelatorio() {
            const agora = new Date();
            let relatorio = `üìã RELAT√ìRIO UPA GUARULHOS\n${agora.toLocaleString('pt-BR')}\n\n`;
            
            medicamentos.forEach(med => {
                const status = med.quantidade <= med.minimo/2 ? 'üö® CR√çTICO' : 
                             med.quantidade <= med.minimo ? '‚ö†Ô∏è ALERTA' : '‚úÖ NORMAL';
                relatorio += `${med.nome}: ${med.quantidade} unidades - ${status}\n`;
            });
            
            // Mostra quantos itens est√£o em alerta/cr√≠tico
            const criticos = medicamentos.filter(med => med.quantidade <= med.minimo/2).length;
            const alertas = medicamentos.filter(med => med.quantidade <= med.minimo && med.quantidade > med.minimo/2).length;
            
            relatorio += `\nüìä RESUMO:\n`;
            relatorio += `üö® Cr√≠ticos: ${criticos}\n`;
            relatorio += `‚ö†Ô∏è  Alertas: ${alertas}\n`;
            relatorio += `‚úÖ Normais: ${medicamentos.length - criticos - alertas}`;
            
            alert(relatorio);
        }

        // VERIFICAR SE OS DADOS EST√ÉO SENDO SALVOS
        function verificarArmazenamento() {
            const dados = localStorage.getItem('quantumStock_upa_guarulhos_v2');
            if (dados) {
                console.log('‚úÖ Dados encontrados no localStorage');
                const parsed = JSON.parse(dados);
                console.log('√öltima atualiza√ß√£o:', parsed.ultimaAtualizacao);
                console.log('Medicamentos:', parsed.medicamentos);
            } else {
                console.log('‚ùå Nenhum dado encontrado no localStorage');
            }
        }

        // INICIALIZAR
        console.log('üîÑ Inicializando sistema...');
        inicializarEstoque();
        atualizarRelogio();
        carregarEstoque();
        verificarArmazenamento();

        // Mostra mensagem de boas-vindas
        setTimeout(() => {
            const estoqueSalvo = carregarEstoqueSalvo();
            if (estoqueSalvo) {
                console.log('‚úÖ Sistema carregado com dados existentes');
            } else {
                console.log('üÜï Sistema iniciado com dados padr√£o');
            }
        }, 1000);
    </script>
</body>
</html>
