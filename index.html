<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuantumStock ‚Ä¢ UPA Guarulhos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <!-- Firebase Database -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        :root {
            --primary: #1e40af;  /* AZUL SA√öDE */
            --primary-dark: #1e3a8a;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #dc2626;
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f8fafc;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(30, 64, 175, 0.3);
            position: relative;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .subtitle {
            font-size: 14px;
            opacity: 0.9;
        }

        .clock {
            margin-top: 10px;
            font-size: 13px;
            background: rgba(255,255,255,0.1);
            padding: 8px 12px;
            border-radius: 10px;
            display: inline-block;
        }

        .status-sincronizacao {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            background: rgba(255,255,255,0.1);
            padding: 5px 10px;
            border-radius: 10px;
        }

        .ponto-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse-status 2s infinite;
        }

        .ponto-status.online {
            background: #10b981;
        }

        .ponto-status.offline {
            background: #6b7280;
        }

        .ponto-status.carregando {
            background: #f59e0b;
        }

        /* CARDS DE ESTOQUE */
        .estoque-grid {
            display: grid;
            gap: 12px;
            margin-bottom: 20px;
        }

        .item-estoque {
            background: var(--card);
            padding: 16px;
            border-radius: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid var(--success);
            transition: all 0.3s ease;
            position: relative;
        }

        .item-estoque.critico {
            border-left-color: var(--danger);
            animation: pulse 2s infinite;
            background: linear-gradient(90deg, rgba(220, 38, 38, 0.1), var(--card));
        }

        .item-estoque.alerta {
            border-left-color: var(--warning);
            background: linear-gradient(90deg, rgba(245, 158, 11, 0.1), var(--card));
        }

        .info-produto h3 {
            font-size: 16px;
            margin-bottom: 4px;
        }

        .categoria {
            font-size: 12px;
            opacity: 0.7;
        }

        .quantidade {
            text-align: right;
        }

        .valor {
            font-size: 20px;
            font-weight: bold;
        }

        .unidade {
            font-size: 12px;
            opacity: 0.7;
        }

        .badge-atualizado {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #10b981;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 8px;
            animation: fadeOut 2s forwards;
        }

        /* CONTROLES */
        .controles {
            background: var(--card);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
        }

        .input-group {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            margin-bottom: 15px;
        }

        select, input, textarea {
            padding: 12px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.05);
            color: var(--text);
            font-size: 16px;
        }

        textarea {
            width: 100%;
            height: 120px;
            resize: vertical;
            font-family: monospace;
        }

        .botoes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        button {
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-entrada {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
        }

        .btn-saida {
            background: linear-gradient(135deg, var(--danger), #b91c1c);
            color: white;
        }

        .btn-relatorio {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            width: 100%;
            margin-bottom: 10px;
        }

        .btn-pdf {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            width: 100%;
            margin-bottom: 10px;
        }

        .btn-login {
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
            color: white;
            width: 100%;
            margin-bottom: 10px;
        }

        .btn-reset {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            width: 100%;
            margin-bottom: 10px;
        }

        /* ALERTAS */
        .alertas {
            margin-bottom: 20px;
        }

        .alerta {
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .alerta.critico {
            background: linear-gradient(90deg, rgba(220, 38, 38, 0.2), rgba(220, 38, 38, 0.1));
            border: 1px solid rgba(220, 38, 38, 0.3);
            animation: pulse-alerta 2s infinite;
        }

        .alerta.atencao {
            background: linear-gradient(90deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.1));
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .ponto-alerta {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .ponto-alerta.critico {
            background: var(--danger);
            box-shadow: 0 0 10px var(--danger);
            animation: pulse-ponto 2s infinite;
        }

        .ponto-alerta.atencao {
            background: var(--warning);
            box-shadow: 0 0 10px var(--warning);
        }

        /* MODAL LOGIN */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--card);
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            text-align: center;
        }

        .modal h2 {
            margin-bottom: 20px;
            color: var(--text);
        }

        .modal-input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.05);
            color: var(--text);
            font-size: 16px;
        }

        .modal-botoes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .btn-confirmar {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
        }

        .btn-cancelar {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
        }

        /* NOTIFICA√á√ÉO */
        .notificacao {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1001;
            display: none;
        }

        .info-sincronizacao {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 14px;
            text-align: center;
        }

        .carregando {
            text-align: center;
            padding: 20px;
            color: var(--text);
            opacity: 0.7;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes pulse-alerta {
            0%, 100% { 
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.4);
            }
            50% { 
                box-shadow: 0 0 0 10px rgba(220, 38, 38, 0);
            }
        }

        @keyframes pulse-ponto {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 10px var(--danger);
            }
            50% { 
                transform: scale(1.2);
                box-shadow: 0 0 20px var(--danger);
            }
        }

        @keyframes pulse-status {
            0%, 100% { 
                opacity: 1;
                transform: scale(1);
            }
            50% { 
                opacity: 0.7;
                transform: scale(1.1);
            }
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            100% { opacity: 0; display: none; }
        }

        /* RESPONSIVO */
        @media (max-width: 380px) {
            .input-group {
                grid-template-columns: 1fr;
            }
            
            .botoes {
                grid-template-columns: 1fr;
            }
            
            .header {
                padding: 15px;
            }
            
            .modal-botoes {
                grid-template-columns: 1fr;
            }
            
            .status-sincronizacao {
                position: static;
                margin-top: 10px;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- NOTIFICA√á√ÉO -->
        <div class="notificacao" id="notificacao"></div>

        <!-- HEADER PERSONALIZADO -->
        <div class="header">
            <div class="logo">üè• UPA Guarulhos</div>
            <div class="subtitle">Controle Inteligente de Medicamentos</div>
            <div class="clock" id="clock">--/--/---- --:--:--</div>
            <div class="status-sincronizacao" id="statusSincronizacao">
                <div class="ponto-status carregando" id="pontoStatus"></div>
                <span id="textoStatus">Carregando...</span>
            </div>
        </div>

        <!-- INFO SINCRONIZA√á√ÉO -->
        <div class="info-sincronizacao">
            üîÑ <strong>SINCRONIZA√á√ÉO EM TEMPO REAL ATIVA</strong> - Todas as altera√ß√µes aparecem instantaneamente em todos os dispositivos
        </div>

        <!-- BOT√ïES SUPERIORES -->
        <button class="btn-relatorio" onclick="gerarRelatorio()">
            üìä GERAR RELAT√ìRIO COMPLETO
        </button>

        <button class="btn-pdf" onclick="gerarPDF()">
            üìÑ BAIXAR RELAT√ìRIO PDF
        </button>
        
        <button class="btn-login" onclick="abrirLogin()" id="btnLogin">
            üîë ACESSO ADMINISTRADOR
        </button>

        <button class="btn-reset" onclick="resetarEstoque()" id="btnReset">
            üîÑ RESTAURAR ESTOQUE PADR√ÉO
        </button>

        <!-- ESTOQUE -->
        <div class="estoque-grid" id="estoqueList">
            <div class="carregando" id="carregandoEstoque">
                ‚è≥ Carregando estoque...
            </div>
        </div>

        <!-- CONTROLES (S√ì VIS√çVEL PARA ADMIN) -->
        <div class="controles" id="controles" style="display: none;">
            <div class="input-group">
                <select id="selectProduto">
                    <option value="">Selecione o medicamento</option>
                </select>
                <input type="number" id="inputQuantidade" placeholder="Qtd" min="1" value="1">
            </div>
            <div class="botoes">
                <button class="btn-entrada" onclick="entradaEstoque()">‚ûï ENTRADA</button>
                <button class="btn-saida" onclick="saidaEstoque()">‚ûñ SA√çDA</button>
            </div>
        </div>

        <!-- ALERTAS -->
        <div class="alertas" id="alertasContainer">
            <!-- Alertas carregados via JavaScript -->
        </div>
    </div>

    <!-- MODAL LOGIN -->
    <div class="modal" id="modalLogin">
        <div class="modal-content">
            <h2>üîí ACESSO ADMINISTRADOR</h2>
            <input type="password" id="senhaAdmin" class="modal-input" placeholder="Digite a senha" onkeypress="verificarEnter(event)">
            <div class="modal-botoes">
                <button class="btn-confirmar" onclick="verificarSenha()">‚úÖ CONFIRMAR</button>
                <button class="btn-cancelar" onclick="fecharLogin()">‚ùå CANCELAR</button>
            </div>
        </div>
    </div>

    <script>
        // DADOS INICIAIS - MEDICAMENTOS HOSPITALARES
        const medicamentosIniciais = [
            { nome: "Dipirona 1g", quantidade: 15, categoria: "Analg√©sico", minimo: 20 },
            { nome: "Paracetamol 750mg", quantidade: 8, categoria: "Analg√©sico", minimo: 15 },
            { nome: "Soro Fisiol√≥gico 500ml", quantidade: 3, categoria: "Soros", minimo: 10 },
            { nome: "Luvas Descart√°veis", quantidade: 45, categoria: "EPI", minimo: 50 },
            { nome: "M√°scara Cir√∫rgica", quantidade: 120, categoria: "EPI", minimo: 100 },
            { nome: "Insulina Regular", quantidade: 5, categoria: "Hormonal", minimo: 8 }
        ];

        // SENHA DO ADMINISTRADOR
        const SENHA_ADMIN = "upa123";
        let adminLogado = false;
        let medicamentos = [];
        let dispositivoId = Math.random().toString(36).substr(2, 9);

        // NOTIFICA√á√ÉO
        function mostrarNotificacao(mensagem, tipo = 'success') {
            const notificacao = document.getElementById('notificacao');
            notificacao.textContent = mensagem;
            notificacao.style.background = tipo === 'success' ? '#10b981' : '#dc2626';
            notificacao.style.display = 'block';
            
            setTimeout(() => {
                notificacao.style.display = 'none';
            }, 4000);
        }

        // ATUALIZAR STATUS DA CONEX√ÉO
        function atualizarStatusConexao(status) {
            const pontoStatus = document.getElementById('pontoStatus');
            const textoStatus = document.getElementById('textoStatus');
            
            if (status === 'online') {
                pontoStatus.className = 'ponto-status online';
                textoStatus.textContent = 'Conectado ‚Ä¢ Tempo Real';
            } else if (status === 'offline') {
                pontoStatus.className = 'ponto-status offline';
                textoStatus.textContent = 'Offline ‚Ä¢ Modo Local';
            } else {
                pontoStatus.className = 'ponto-status carregando';
                textoStatus.textContent = 'Carregando...';
            }
        }

        // SINCRONIZA√á√ÉO SIMPLIFICADA (SEM FIREBASE POR ENQUANTO)
        function inicializarSincronizacao() {
            // Por enquanto, vamos usar apenas localStorage
            // Depois podemos adicionar Firebase se necess√°rio
            atualizarStatusConexao('online');
            mostrarNotificacao('‚úÖ Sistema carregado com sucesso!');
        }

        // FUN√á√ïES DE ARMAZENAMENTO
        function salvarEstoque() {
            try {
                const dados = {
                    medicamentos: medicamentos,
                    ultimaAtualizacao: new Date().toISOString(),
                    versao: '3.0'
                };
                localStorage.setItem('quantumStock_upa_guarulhos', JSON.stringify(dados));
                console.log('‚úÖ Estoque salvo localmente');
            } catch (e) {
                console.error('‚ùå Erro ao salvar:', e);
            }
        }

        function carregarEstoqueSalvo() {
            try {
                const dadosSalvos = localStorage.getItem('quantumStock_upa_guarulhos');
                if (dadosSalvos) {
                    const dados = JSON.parse(dadosSalvos);
                    console.log('üì¶ Estoque carregado localmente');
                    return dados.medicamentos;
                }
            } catch (e) {
                console.error('‚ùå Erro ao carregar:', e);
            }
            return null;
        }

        function inicializarEstoque() {
            // Esconder mensagem de carregando
            document.getElementById('carregandoEstoque').style.display = 'none';
            
            const estoqueSalvo = carregarEstoqueSalvo();
            if (estoqueSalvo && estoqueSalvo.length > 0) {
                medicamentos = estoqueSalvo;
                mostrarNotificacao('üì¶ Dados locais carregados!');
            } else {
                medicamentos = JSON.parse(JSON.stringify(medicamentosIniciais));
                salvarEstoque();
                mostrarNotificacao('üÜï Estoque inicial criado!');
            }
            
            carregarEstoque();
            inicializarSincronizacao();
        }

        // GERAR PDF
        function gerarPDF() {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                const agora = new Date();
                const dataHora = agora.toLocaleString('pt-BR');

                // Cabe√ßalho
                doc.setFillColor(30, 64, 175);
                doc.rect(0, 0, 210, 40, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(20);
                doc.setFont('helvetica', 'bold');
                doc.text('üè• UPA GUARULHOS', 105, 15, { align: 'center' });
                doc.setFontSize(12);
                doc.text('Relat√≥rio de Estoque de Medicamentos', 105, 25, { align: 'center' });
                doc.text(`Gerado em: ${dataHora}`, 105, 32, { align: 'center' });

                doc.setTextColor(0, 0, 0);

                // Dados para a tabela
                const tableData = medicamentos.map(med => {
                    let status = 'NORMAL';
                    let corStatus = '#10b981';
                    
                    if (med.quantidade <= med.minimo / 2) {
                        status = 'CR√çTICO';
                        corStatus = '#dc2626';
                    } else if (med.quantidade <= med.minimo) {
                        status = 'ALERTA';
                        corStatus = '#f59e0b';
                    }

                    return [
                        med.nome,
                        med.categoria,
                        med.quantidade.toString(),
                        med.minimo.toString(),
                        status
                    ];
                });

                // Adicionar tabela
                doc.autoTable({
                    startY: 45,
                    head: [['Medicamento', 'Categoria', 'Quantidade', 'M√≠nimo', 'Status']],
                    body: tableData,
                    theme: 'grid',
                    styles: {
                        fontSize: 10,
                        cellPadding: 3,
                    },
                    headStyles: {
                        fillColor: [30, 64, 175],
                        textColor: 255,
                        fontStyle: 'bold'
                    },
                    didDrawCell: function(data) {
                        if (data.column.index === 4 && data.cell.section === 'body') {
                            const status = data.cell.raw;
                            if (status === 'CR√çTICO') {
                                doc.setFillColor(220, 38, 38);
                            } else if (status === 'ALERTA') {
                                doc.setFillColor(245, 158, 11);
                            } else {
                                doc.setFillColor(16, 185, 129);
                            }
                            doc.rect(data.cell.x, data.cell.y, data.cell.width, data.cell.height, 'F');
                            doc.setTextColor(255, 255, 255);
                            doc.text(status, data.cell.x + data.cell.width / 2, data.cell.y + data.cell.height / 2 + 2, { align: 'center' });
                            return false;
                        }
                    }
                });

                // Estat√≠sticas
                const finalY = doc.lastAutoTable.finalY + 10;
                const criticos = medicamentos.filter(med => med.quantidade <= med.minimo / 2).length;
                const alertas = medicamentos.filter(med => med.quantidade <= med.minimo && med.quantidade > med.minimo / 2).length;
                const normais = medicamentos.length - criticos - alertas;

                doc.setFontSize(12);
                doc.setFont('helvetica', 'bold');
                doc.text('RESUMO DO ESTOQUE', 14, finalY);
                
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.text(`‚úÖ Itens em situa√ß√£o normal: ${normais}`, 20, finalY + 8);
                doc.text(`‚ö†Ô∏è  Itens em alerta: ${alertas}`, 20, finalY + 16);
                doc.text(`üö® Itens cr√≠ticos: ${criticos}`, 20, finalY + 24);
                doc.text(`üìä Total de itens monitorados: ${medicamentos.length}`, 20, finalY + 32);

                // Rodap√©
                const pageHeight = doc.internal.pageSize.height;
                doc.setFontSize(8);
                doc.setTextColor(100, 100, 100);
                doc.text('Sistema QuantumStock - UPA Guarulhos ‚Ä¢ Relat√≥rio gerado automaticamente', 105, pageHeight - 10, { align: 'center' });

                // Salvar PDF
                const nomeArquivo = `relatorio_estoque_upa_${agora.toISOString().split('T')[0]}.pdf`;
                doc.save(nomeArquivo);
                
                mostrarNotificacao('‚úÖ PDF gerado e baixado com sucesso!');

            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                mostrarNotificacao('‚ùå Erro ao gerar PDF. Tente novamente.', 'error');
            }
        }

        // ATUALIZAR REL√ìGIO
        function atualizarRelogio() {
            const agora = new Date();
            document.getElementById('clock').textContent = 
                agora.toLocaleDateString('pt-BR') + ' ' + 
                agora.toLocaleTimeString('pt-BR');
            setTimeout(atualizarRelogio, 1000);
        }

        // CARREGAR ESTOQUE NA TELA
        function carregarEstoque() {
            const container = document.getElementById('estoqueList');
            const select = document.getElementById('selectProduto');
            
            // Limpar container
            container.innerHTML = '';
            select.innerHTML = '<option value="">Selecione o medicamento</option>';
            
            // Verificar se h√° medicamentos
            if (!medicamentos || medicamentos.length === 0) {
                container.innerHTML = `
                    <div class="carregando">
                        ‚ùå Nenhum medicamento encontrado. Clique em "Restaurar Estoque Padr√£o".
                    </div>
                `;
                return;
            }
            
            // Adicionar cada medicamento
            medicamentos.forEach((med, index) => {
                const item = document.createElement('div');
                item.className = `item-estoque ${med.quantidade <= med.minimo/2 ? 'critico' : 
                                 med.quantidade <= med.minimo ? 'alerta' : ''}`;
                
                item.innerHTML = `
                    <div class="info-produto">
                        <h3>${med.nome}</h3>
                        <div class="categoria">${med.categoria}</div>
                    </div>
                    <div class="quantidade">
                        <div class="valor">${med.quantidade}</div>
                        <div class="unidade">unidades</div>
                    </div>
                `;
                container.appendChild(item);
                
                if (adminLogado) {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = med.nome;
                    select.appendChild(option);
                }
            });
            
            carregarAlertas();
        }

        // CARREGAR ALERTAS
        function carregarAlertas() {
            const container = document.getElementById('alertasContainer');
            container.innerHTML = '';
            
            const alertas = medicamentos.filter(med => med.quantidade <= med.minimo);
            
            if (alertas.length === 0) {
                container.innerHTML = `
                    <div class="alerta" style="background: rgba(16, 185, 129, 0.1); border-color: rgba(16, 185, 129, 0.3);">
                        <div class="ponto-alerta" style="background: #10b981;"></div>
                        <div>‚úÖ Todos os medicamentos em ordem!</div>
                    </div>
                `;
                return;
            }
            
            alertas.forEach(med => {
                const alerta = document.createElement('div');
                alerta.className = `alerta ${med.quantidade <= med.minimo/2 ? 'critico' : 'atencao'}`;
                alerta.innerHTML = `
                    <div class="ponto-alerta ${med.quantidade <= med.minimo/2 ? 'critico' : 'atencao'}"></div>
                    <div>
                        ${med.quantidade <= med.minimo/2 ? 'üö® CR√çTICO' : '‚ö†Ô∏è ATEN√á√ÉO'}: 
                        ${med.nome} - ${med.quantidade} unidades (m√≠nimo: ${med.minimo})
                    </div>
                `;
                container.appendChild(alerta);
            });
        }

        // FUN√á√ïES DE LOGIN
        function abrirLogin() {
            document.getElementById('modalLogin').style.display = 'flex';
            document.getElementById('senhaAdmin').focus();
        }

        function fecharLogin() {
            document.getElementById('modalLogin').style.display = 'none';
            document.getElementById('senhaAdmin').value = '';
        }

        function verificarEnter(event) {
            if (event.key === 'Enter') {
                verificarSenha();
            }
        }

        function verificarSenha() {
            const senha = document.getElementById('senhaAdmin').value;
            
            if (senha === SENHA_ADMIN) {
                adminLogado = true;
                document.getElementById('controles').style.display = 'block';
                document.getElementById('btnLogin').textContent = 'üîì ADMINISTRADOR LOGADO';
                document.getElementById('btnLogin').style.background = 'linear-gradient(135deg, #10b981, #059669)';
                fecharLogin();
                carregarEstoque();
                mostrarNotificacao('‚úÖ Acesso administrativo concedido!');
            } else {
                mostrarNotificacao('‚ùå Senha incorreta! Acesso negado.', 'error');
                document.getElementById('senhaAdmin').value = '';
                document.getElementById('senhaAdmin').focus();
            }
        }

        // ENTRADA NO ESTOQUE
        function entradaEstoque() {
            if (!adminLogado) {
                mostrarNotificacao('üîí Acesso restrito! Fa√ßa login como administrador.', 'error');
                abrirLogin();
                return;
            }
            
            const select = document.getElementById('selectProduto');
            const input = document.getElementById('inputQuantidade');
            const index = parseInt(select.value);
            const quantidade = parseInt(input.value);
            
            if (isNaN(index) || isNaN(quantidade) || quantidade <= 0) {
                mostrarNotificacao('‚ùå Selecione um medicamento e informe uma quantidade v√°lida!', 'error');
                return;
            }
            
            const quantidadeAntiga = medicamentos[index].quantidade;
            medicamentos[index].quantidade += quantidade;
            input.value = 1;
            
            salvarEstoque();
            carregarEstoque();
            
            mostrarNotificacao(`‚úÖ ${quantidade} ${medicamentos[index].nome} adicionados! (${quantidadeAntiga} ‚Üí ${medicamentos[index].quantidade})`);
        }

        // SA√çDA DO ESTOQUE
        function saidaEstoque() {
            if (!adminLogado) {
                mostrarNotificacao('üîí Acesso restrito! Fa√ßa login como administrador.', 'error');
                abrirLogin();
                return;
            }
            
            const select = document.getElementById('selectProduto');
            const input = document.getElementById('inputQuantidade');
            const index = parseInt(select.value);
            const quantidade = parseInt(input.value);
            
            if (isNaN(index) || isNaN(quantidade) || quantidade <= 0) {
                mostrarNotificacao('‚ùå Selecione um medicamento e informe uma quantidade v√°lida!', 'error');
                return;
            }
            
            if (medicamentos[index].quantidade < quantidade) {
                mostrarNotificacao(`‚ùå Estoque insuficiente! Dispon√≠vel: ${medicamentos[index].quantidade}`, 'error');
                return;
            }
            
            const quantidadeAntiga = medicamentos[index].quantidade;
            medicamentos[index].quantidade -= quantidade;
            input.value = 1;
            
            salvarEstoque();
            carregarEstoque();
            
            mostrarNotificacao(`‚úÖ ${quantidade} ${medicamentos[index].nome} retirados! (${quantidadeAntiga} ‚Üí ${medicamentos[index].quantidade})`);
        }

        // RESETAR ESTOQUE
        function resetarEstoque() {
            if (!adminLogado) {
                mostrarNotificacao('üîí Acesso restrito! Fa√ßa login como administrador.', 'error');
                abrirLogin();
                return;
            }
            
            if (confirm('‚ö†Ô∏è Tem certeza que deseja restaurar o estoque para os valores padr√£o?')) {
                medicamentos = JSON.parse(JSON.stringify(medicamentosIniciais));
                salvarEstoque();
                carregarEstoque();
                mostrarNotificacao('‚úÖ Estoque restaurado para os valores padr√£o!');
            }
        }

        // GERAR RELAT√ìRIO
        function gerarRelatorio() {
            const agora = new Date();
            let relatorio = `üìã RELAT√ìRIO UPA GUARULHOS\n${agora.toLocaleString('pt-BR')}\n\n`;
            
            medicamentos.forEach(med => {
                const status = med.quantidade <= med.minimo/2 ? 'üö® CR√çTICO' : 
                             med.quantidade <= med.minimo ? '‚ö†Ô∏è ALERTA' : '‚úÖ NORMAL';
                relatorio += `${med.nome}: ${med.quantidade} unidades - ${status}\n`;
            });
            
            const criticos = medicamentos.filter(med => med.quantidade <= med.minimo/2).length;
            const alertas = medicamentos.filter(med => med.quantidade <= med.minimo && med.quantidade > med.minimo/2).length;
            
            relatorio += `\nüìä RESUMO:\n`;
            relatorio += `üö® Cr√≠ticos: ${criticos}\n`;
            relatorio += `‚ö†Ô∏è  Alertas: ${alertas}\n`;
            relatorio += `‚úÖ Normais: ${medicamentos.length - criticos - alertas}`;
            
            alert(relatorio);
        }

        // INICIALIZAR TUDO
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Iniciando sistema QuantumStock...');
            atualizarRelogio();
            inicializarEstoque();
        });

    </script>
</body>
</html>
